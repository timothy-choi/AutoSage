name: One-Time Auto Commit

on:
  schedule:
    - cron: '0 10 26 6 *'  # Runs at 9:00 UTC on June 25
  workflow_dispatch:       # (optional) allows manual run

jobs:
  auto-commit:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Create placeholder file
      run: |
        echo "import requests
from datetime import datetime

ALLOWED_REACTIONS = ["clap", "heart", "thumbs_up"]
REACTION_EMOJIS = {
    "clap": "👏",
    "heart": "❤️",
    "thumbs_up": "👍",
    "laugh": "😂",
    "wow": "😲"
}

def parse_reaction_event(payload: dict):
    obj = payload.get("payload", {}).get("object", {})
    participant = obj.get("participant", {})

    return {
        "meeting_id": obj.get("id"),
        "participant_user_id": participant.get("user_id"),
        "participant_name": participant.get("user_name"),
        "email": participant.get("email"),
        "reaction_type": participant.get("reaction_type"),
        "timestamp": participant.get("time")
    }

def is_reaction_allowed(reaction_type: str):
    return reaction_type in ALLOWED_REACTIONS

def is_email_domain_allowed(email: str, allowed_domains: list):
    return any(email.endswith("@" + domain.strip()) for domain in allowed_domains)

def format_human_time(iso_timestamp: str):
    try:
        return datetime.fromisoformat(iso_timestamp.replace("Z", "+00:00")).strftime("%Y-%m-%d %H:%M:%S UTC")
    except Exception:
        return iso_timestamp

def forward_reaction_to_webhook(reaction_data, webhook_url):
    try:
        response = requests.post(webhook_url, json=reaction_data)
        return {"status_code": response.status_code, "text": response.text}
    except Exception as e:
        return {"error": str(e)}
" > backend/Components/Zoom/ZoomReactionTrackerHelper.py

    - name: Configure Git
      run: |
        git config user.name "timothy-choi"
        git config user.email "tchoi720@gmail.com"

    - name: Commit and push
      run: |
        git add backend/Components/Zoom/ZoomReactionTrackerHelper.py
        git commit -m "Added zoom reaction tracker helper" || echo "No changes"
        git push
